package HTMLExtractor;

import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.nio.charset.Charset;
import java.util.HashMap;
import java.util.Map;

import org.apache.commons.io.FileUtils;
import org.apache.commons.io.IOUtils;
import org.json.JSONArray;
import org.json.JSONObject;

import HTMLExtractor.MalwareDomainListExtractor;
import HTMLExtractor.MalwareDomainListToStixExtractor;

import org.junit.Test;

import static org.junit.Assert.*;

import org.mitre.stix.stix_1.STIXPackage;

/**
 * Unit test for Malware Domain List extractor.
 */				
public class MalwareDomainListToStixExtractorTest{
	
	private Map<String,String> loadContent(String entryName, boolean localMode) throws IOException{
		Map<String,String> pageContent = new HashMap<String,String>();
		String filePath = "./testData/malwaredomainlist/";
		Charset charset = Charset.defaultCharset();
		if(localMode){
			File infoFD = new File(filePath + entryName);
			String content = FileUtils.readFileToString(infoFD, charset);
			pageContent.put("content", content);
		}
		else{
			URL u;
			u = new URL("http://www.malwaredomainlist.com/mdl.php?search="+entryName);
			pageContent.put("content", IOUtils.toString(u));
		}
		return pageContent;
	}
	
	/**
	 * Test with "alsoknowsit.com" sample data
	 */
	@Test
	public void test_alsoknowsit_com()
	{
		String entryName = "alsoknowsit.com";
		boolean localMode = true;
		String content;
		
		try {
			Map<String,String> pageContent = loadContent(entryName, localMode);
			content = pageContent.get("content");
			
			MalwareDomainListToStixExtractor mdlTsExt = new MalwareDomainListToStixExtractor(content);
			STIXPackage receivedPackage = mdlTsExt.getStixPackage();
									
		//	System.out.println(receivedPackage.toXMLString(true));
							
			String expectedVerts =
				"<?xml version=\"1.0\" encoding=\"UTF-8\"?> " +
				"<stix:STIX_Package " +
				"    id=\"stucco:MalwareDomainList-e328bc62-77b5-4578-a081-636dba91fdd9\" " +
				"    timestamp=\"2015-07-09T19:34:26.715Z\" " +
				"    xmlns=\"http://xml/metadataSharing.xsd\" " +
				"    xmlns:AddressObj=\"http://cybox.mitre.org/objects#AddressObject-2\" " +
				"    xmlns:DNSRecordObj=\"http://cybox.mitre.org/objects#DNSRecordObject-2\" " +
				"    xmlns:URIObj=\"http://cybox.mitre.org/objects#URIObject-2\" " +
				"    xmlns:cybox=\"http://cybox.mitre.org/cybox-2\" " +
				"    xmlns:cyboxCommon=\"http://cybox.mitre.org/common-2\" " +
				"    xmlns:indicator=\"http://stix.mitre.org/Indicator-2\" " +
				"    xmlns:stix=\"http://stix.mitre.org/stix-1\" " +
				"    xmlns:stixCommon=\"http://stix.mitre.org/common-1\" " +
				"    xmlns:stucco=\"stucco\" xmlns:ttp=\"http://stix.mitre.org/TTP-1\"> " +
				"    <stix:STIX_Header> " +
				"        <stix:Title>MalwareDomainList</stix:Title> " +
				"    </stix:STIX_Header> " +
				"    <stix:Indicators> " +
				"        <stix:Indicator " +											
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>Malware</indicator:Type> " +
				"            <indicator:Valid_Time_Position> " +
				"                <indicator:Start_Time>2014-09-02T05:11:00.000-04:00</indicator:Start_Time> " +
				"            </indicator:Valid_Time_Position> " +
				"            <indicator:Indicated_TTP> " +
				"                <stixCommon:TTP xsi:type=\"ttp:TTPType\"> " +
				"                    <ttp:Behavior> " +
				"                        <ttp:Malware> " +
				"                            <ttp:Malware_Instance> " +
				"                                <ttp:Name>MalwareDomainList_alsoknowsit.com</ttp:Name> " +
				"                                <ttp:Description>Zeus config file</ttp:Description> " +
				"                            </ttp:Malware_Instance> " +
				"                        </ttp:Malware> " +
				"                    </ttp:Behavior> " +
				"                    <ttp:Resources> " +
				"                        <ttp:Tools> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>alsoknowsit.com/wp-files/config.bin</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                        </ttp:Tools> " +
				"                    </ttp:Resources> " +
				"                    <ttp:Information_Source> " +
				"                        <stixCommon:Identity> " +
				"                            <stixCommon:Name>MalwareDomainList</stixCommon:Name> " +
				"                        </stixCommon:Identity> " +
				"                    </ttp:Information_Source> " +
				"                </stixCommon:TTP> " +
				"            </indicator:Indicated_TTP> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>DNSName</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Properties xsi:type=\"DNSRecordObj:DNSRecordObjectType\"> " +
				"                        <DNSRecordObj:Description>alsoknowsit.com</DNSRecordObj:Description> " +
				"                        <DNSRecordObj:Domain_Name> " +
				"                            <URIObj:Value>alsoknowsit.com</URIObj:Value> " +
				"                        </DNSRecordObj:Domain_Name> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +											
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>DNSName</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +			
				"                    <cybox:Properties xsi:type=\"DNSRecordObj:DNSRecordObjectType\"> " +
				"                        <DNSRecordObj:Description>kvm.arconet.ee.</DNSRecordObj:Description> " +
				"                        <DNSRecordObj:Domain_Name> " +
				"                            <URIObj:Value>kvm.arconet.ee.</URIObj:Value> " +
				"                        </DNSRecordObj:Domain_Name> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +										
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>ip</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Description>80.250.114.239</cybox:Description> " +
				"                    <cybox:Properties category=\"ipv4-addr\" xsi:type=\"AddressObj:AddressObjectType\"> " +
				"                        <AddressObj:Address_Value>80.250.114.239</AddressObj:Address_Value> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +											
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>Address</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Description>80.250.114.239, port 80</cybox:Description> " +
				"                    <cybox:Properties category=\"ipv4-addr\" xsi:type=\"AddressObj:AddressObjectType\"> " +
				"                        <AddressObj:Address_Value>80.250.114.239:80</AddressObj:Address_Value> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"    </stix:Indicators> " +
				"</stix:STIX_Package> ";	    		

				//TODO add edges code to the extractor ......
				String expectedEdges = "["+
				"    {"+
				"      '_type': 'edge',"+
		    		"      'outVType': 'malware',"+
		    		"      'source': 'MalwareDomainList',"+
		    		"      '_id': 'MalwareDomainList_alsoknowsit.com_communicatesWith_80.250.114.239:80',"+
		    		"      'description': 'MalwareDomainList_alsoknowsit.com communicates with 80.250.114.239, port 80',"+
		    		"      '_outV': 'MalwareDomainList_alsoknowsit.com',"+
		    		"      '_label': 'communicatesWith',"+
		    		"      'inVType': 'address',"+
		    		"      '_inV': '80.250.114.239:80'"+
		    		"    },"+
		    		"    {"+
		    		"      '_type': 'edge',"+
		    		"      'outVType': 'address',"+
		    		"      'source': 'MalwareDomainList',"+
		    		"      '_id': '80.250.114.239:80_hasIP_80.250.114.239',"+
		    		"      'description': '80.250.114.239, port 80 has IP 80.250.114.239',"+
		    		"      '_outV': '80.250.114.239:80',"+
		    		"      '_label': 'hasIP',"+
		    		"      'inVType': 'ip',"+
		    		"      '_inV': '80.250.114.239'"+
		    		"    },"+
		    		"    {"+
		    		"      '_type': 'edge',"+
		    		"      'reverse': false,"+
		    		"      'outVType': 'address',"+
		    		"      'source': 'MalwareDomainList',"+
		    		"      '_id': '80.250.114.239:80_hasDNSName_alsoknowsit.com',"+
		    		"      'description': '80.250.114.239, port 80 has DNS name alsoknowsit.com',"+
		    		"      '_outV': '80.250.114.239:80',"+
		    		"      '_label': 'hasDNSName',"+
		    		"      'inVType': 'DNSName',"+
		    		"      '_inV': 'alsoknowsit.com'"+
		    		"    },"+
		    		"    {"+
		    		"      '_type': 'edge',"+
		    		"      'reverse': true,"+
		    		"      'outVType': 'address',"+
		    		"      'source': 'MalwareDomainList',"+
		    		"      '_id': '80.250.114.239:80_hasDNSName_kvm.arconet.ee.',"+
		    		"      'description': '80.250.114.239, port 80 has DNS name kvm.arconet.ee.',"+
		    		"      '_outV': '80.250.114.239:80',"+
		    		"      '_label': 'hasDNSName',"+
		    		"      'inVType': 'DNSName',"+
		    		"      '_inV': 'kvm.arconet.ee.'"+
		    		"    }"+
		    		"  ]";
		    
			STIXPackage expectedPackage = new STIXPackage().fromXMLString(expectedVerts);
			
			assertTrue(mdlTsExt.validate(receivedPackage));
			
			assertEquals(expectedPackage.getIndicators(), receivedPackage.getIndicators());

		} catch (IOException e) {
			e.printStackTrace();
			fail("IOException");
		} catch (Exception e) {
			e.printStackTrace();
			fail("Exception");
		}
	}
	
	/**
	 * Test with "46.183.221.58" sample data
	 */
	@Test
	public void test_46_183_221_58()
	{
		String entryName = "46.183.221.58";
		boolean localMode = true;
		String content;
		
		try {
			Map<String,String> pageContent = loadContent(entryName, localMode);
			content = pageContent.get("content");
			
			MalwareDomainListToStixExtractor mdlTsExt = new MalwareDomainListToStixExtractor(content);
			STIXPackage receivedPackage = mdlTsExt.getStixPackage();
									
		//	System.out.println(receivedPackage.toXMLString(true));
							
			String expectedVerts = 
				"<?xml version=\"1.0\" encoding=\"UTF-8\"?> " +
				"<stix:STIX_Package " +
				"    id=\"stucco:MalwareDomainList-98bf3de3-3cd3-4092-80d7-cc19ab2f9d4c\" " +
				"    timestamp=\"2015-07-09T20:22:12.407Z\" " +
				"    xmlns=\"http://xml/metadataSharing.xsd\" " +
				"    xmlns:AddressObj=\"http://cybox.mitre.org/objects#AddressObject-2\" " +
				"    xmlns:DNSRecordObj=\"http://cybox.mitre.org/objects#DNSRecordObject-2\" " +
				"    xmlns:URIObj=\"http://cybox.mitre.org/objects#URIObject-2\" " +
				"    xmlns:cybox=\"http://cybox.mitre.org/cybox-2\" " +
				"    xmlns:cyboxCommon=\"http://cybox.mitre.org/common-2\" " +
				"    xmlns:indicator=\"http://stix.mitre.org/Indicator-2\" " +
				"    xmlns:stix=\"http://stix.mitre.org/stix-1\" " +
				"    xmlns:stixCommon=\"http://stix.mitre.org/common-1\" " +
				"    xmlns:stucco=\"stucco\" xmlns:ttp=\"http://stix.mitre.org/TTP-1\"> " +
				"    <stix:STIX_Header> " +
				"        <stix:Title>MalwareDomainList</stix:Title> " +
				"    </stix:STIX_Header> " +
				"    <stix:Indicators> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>Malware</indicator:Type> " +
				"            <indicator:Valid_Time_Position> " +
				"                <indicator:Start_Time>2014-08-03T14:10:00.000-04:00</indicator:Start_Time> " +
				"            </indicator:Valid_Time_Position> " +
				"            <indicator:Indicated_TTP> " +
				"                <stixCommon:TTP xsi:type=\"ttp:TTPType\"> " +
				"                    <ttp:Behavior> " +
				"                        <ttp:Malware> " +
				"                            <ttp:Malware_Instance> " +
				"                                <ttp:Name>MalwareDomainList_46.183.221.58</ttp:Name> " +
				"                                <ttp:Description>Trojan.Zbot</ttp:Description> " +
				"                            </ttp:Malware_Instance> " +
				"                        </ttp:Malware> " +
				"                    </ttp:Behavior> " +
				"                    <ttp:Resources> " +
				"                        <ttp:Tools> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>46.183.221.58/snow/bot.exe</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>46.183.221.58/we/bot.exe</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                        </ttp:Tools> " +
				"                    </ttp:Resources> " +
				"                    <ttp:Information_Source> " +
				"                        <stixCommon:Identity> " +
				"                            <stixCommon:Name>MalwareDomainList</stixCommon:Name> " +
				"                        </stixCommon:Identity> " +
				"                    </ttp:Information_Source> " +
				"                </stixCommon:TTP> " +
				"            </indicator:Indicated_TTP> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>DNSName</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Properties xsi:type=\"DNSRecordObj:DNSRecordObjectType\"> " +
				"                        <DNSRecordObj:Description>ip-221-58.dataclub.biz.</DNSRecordObj:Description> " +
				"                        <DNSRecordObj:Domain_Name> " +
				"                            <URIObj:Value>ip-221-58.dataclub.biz.</URIObj:Value> " +
				"                        </DNSRecordObj:Domain_Name> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>ip</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Description>46.183.221.58</cybox:Description> " +
				"                    <cybox:Properties category=\"ipv4-addr\" xsi:type=\"AddressObj:AddressObjectType\"> " +
				"                        <AddressObj:Address_Value>46.183.221.58</AddressObj:Address_Value> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>Address</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Description>46.183.221.58, port 80</cybox:Description> " +
				"                    <cybox:Properties category=\"ipv4-addr\" xsi:type=\"AddressObj:AddressObjectType\"> " +
				"                        <AddressObj:Address_Value>46.183.221.58:80</AddressObj:Address_Value> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"    </stix:Indicators> " +
				"</stix:STIX_Package> ";

		    String expectedEdges = "["+
		    		"    {"+
		    		"      '_type': 'edge',"+
		    		"      'outVType': 'malware',"+
		    		"      'source': 'MalwareDomainList',"+
		    		"      '_id': 'MalwareDomainList_46.183.221.58_communicatesWith_46.183.221.58:80',"+
		    		"      'description': 'MalwareDomainList_46.183.221.58 communicates with 46.183.221.58, port 80',"+
		    		"      '_outV': 'MalwareDomainList_46.183.221.58',"+
		    		"      '_label': 'communicatesWith',"+
		    		"      'inVType': 'address',"+
		    		"      '_inV': '46.183.221.58:80'"+
		    		"    },"+
		    		"    {"+
		    		"      '_type': 'edge',"+
		    		"      'outVType': 'address',"+
		    		"      'source': 'MalwareDomainList',"+
		    		"      '_id': '46.183.221.58:80_hasIP_46.183.221.58',"+
		    		"      'description': '46.183.221.58, port 80 has IP 46.183.221.58',"+
		    		"      '_outV': '46.183.221.58:80',"+
		    		"      '_label': 'hasIP',"+
		    		"      'inVType': 'ip',"+
		    		"      '_inV': '46.183.221.58'"+
		    		"    },"+
		    		"    {"+
		    		"      '_type': 'edge',"+
		    		"      'reverse': true,"+
		    		"      'outVType': 'address',"+
		    		"      'source': 'MalwareDomainList',"+
		    		"      '_id': '46.183.221.58:80_hasDNSName_ip-221-58.dataclub.biz.',"+
		    		"      'description': '46.183.221.58, port 80 has DNS name ip-221-58.dataclub.biz.',"+
		    		"      '_outV': '46.183.221.58:80',"+
		    		"      '_label': 'hasDNSName',"+
		    		"      'inVType': 'DNSName',"+
		    		"      '_inV': 'ip-221-58.dataclub.biz.'"+
		    		"    }"+
			    	  "]";
		    
		
			STIXPackage expectedPackage = new STIXPackage().fromXMLString(expectedVerts);
			
			assertTrue(mdlTsExt.validate(receivedPackage));
			
			assertEquals(expectedPackage.getIndicators(), receivedPackage.getIndicators());
		    
		} catch (IOException e) {
			e.printStackTrace();
			fail("IOException");
		} catch (Exception e) {
			e.printStackTrace();
			fail("Exception");
		}
	}

	
	/**
	 * Test with "notes.art-partner.net" sample data
	 */
	@Test
	public void test_notes_art_partner_net()
	{
		String entryName = "notes.art-partner.net";
		boolean localMode = true;
		String content;
		
		try {
			Map<String,String> pageContent = loadContent(entryName, localMode);
			content = pageContent.get("content");
			
			MalwareDomainListToStixExtractor mdlTsExt = new MalwareDomainListToStixExtractor(content);
			STIXPackage receivedPackage = mdlTsExt.getStixPackage();
									
		//	System.out.println(receivedPackage.toXMLString(true));
							
		    String expectedEdges = "["+
		    		"  {"+
		    		"    '_type': 'edge',"+
		    		"    'outVType': 'malware',"+
		    		"    'source': 'MalwareDomainList',"+
		    		"    '_id': 'MalwareDomainList_notes.art-partner.net_communicatesWith_62.76.188.80:80',"+
		    		"    'description': 'MalwareDomainList_notes.art-partner.net communicates with 62.76.188.80, port 80',"+
		    		"    '_outV': 'MalwareDomainList_notes.art-partner.net',"+
		    		"    '_label': 'communicatesWith',"+
		    		"    'inVType': 'address',"+
		    		"    '_inV': '62.76.188.80:80'"+
		    		"  },"+
		    		"  {"+
		    		"    '_type': 'edge',"+
		    		"    'outVType': 'address',"+
		    		"    'source': 'MalwareDomainList',"+
		    		"    '_id': '62.76.188.80:80_hasIP_62.76.188.80',"+
		    		"    'description': '62.76.188.80, port 80 has IP 62.76.188.80',"+
		    		"    '_outV': '62.76.188.80:80',"+
		    		"    '_label': 'hasIP',"+
		    		"    'inVType': 'ip',"+
		    		"    '_inV': '62.76.188.80'"+
		    		"  },"+
		    		"  {"+
		    		"    '_type': 'edge',"+
		    		"    'reverse': false,"+
		    		"    'outVType': 'address',"+
		    		"    'source': 'MalwareDomainList',"+
		    		"    '_id': '62.76.188.80:80_hasDNSName_notes.art-partner.net',"+
		    		"    'description': '62.76.188.80, port 80 has DNS name notes.art-partner.net',"+
		    		"    '_outV': '62.76.188.80:80',"+
		    		"    '_label': 'hasDNSName',"+
		    		"    'inVType': 'DNSName',"+
		    		"    '_inV': 'notes.art-partner.net'"+
		    		"  },"+
		    		"  {"+
		    		"    '_type': 'edge',"+
		    		"    'reverse': true,"+
		    		"    'outVType': 'address',"+
		    		"    'source': 'MalwareDomainList',"+
		    		"    '_id': '62.76.188.80:80_hasDNSName_62-76-188-80.clodo.ru.',"+
		    		"    'description': '62.76.188.80, port 80 has DNS name 62-76-188-80.clodo.ru.',"+
		    		"    '_outV': '62.76.188.80:80',"+
		    		"    '_label': 'hasDNSName',"+
		    		"    'inVType': 'DNSName',"+
		    		"    '_inV': '62-76-188-80.clodo.ru.'"+
		    		"  }"+
			    	  "]";
		    
			String expectedVerts = 
				"<?xml version=\"1.0\" encoding=\"UTF-8\"?> " +
				"<stix:STIX_Package " +
				"    id=\"stucco:MalwareDomainList-3dce44bf-1d4c-4f26-b947-d6af71917f14\" " +
				"    timestamp=\"2015-07-09T20:35:47.241Z\" " +
				"    xmlns=\"http://xml/metadataSharing.xsd\" " +
				"    xmlns:AddressObj=\"http://cybox.mitre.org/objects#AddressObject-2\" " +
				"    xmlns:DNSRecordObj=\"http://cybox.mitre.org/objects#DNSRecordObject-2\" " +
				"    xmlns:URIObj=\"http://cybox.mitre.org/objects#URIObject-2\" " +
				"    xmlns:cybox=\"http://cybox.mitre.org/cybox-2\" " +
				"    xmlns:cyboxCommon=\"http://cybox.mitre.org/common-2\" " +
				"    xmlns:indicator=\"http://stix.mitre.org/Indicator-2\" " +
				"    xmlns:stix=\"http://stix.mitre.org/stix-1\" " +
				"    xmlns:stixCommon=\"http://stix.mitre.org/common-1\" " +
				"    xmlns:stucco=\"stucco\" xmlns:ttp=\"http://stix.mitre.org/TTP-1\"> " +
				"    <stix:STIX_Header> " +
				"        <stix:Title>MalwareDomainList</stix:Title> " +
				"    </stix:STIX_Header> " +
				"    <stix:Indicators> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>Malware</indicator:Type> " +
				"            <indicator:Valid_Time_Position> " +
				"                <indicator:Start_Time>2014-08-21T22:52:00.000-04:00</indicator:Start_Time> " +
				"            </indicator:Valid_Time_Position> " +
				"            <indicator:Indicated_TTP> " +
				"                <stixCommon:TTP xsi:type=\"ttp:TTPType\"> " +
				"                    <ttp:Behavior> " +
				"                        <ttp:Malware> " +
				"                            <ttp:Malware_Instance> " +
				"                                <ttp:Name>MalwareDomainList_notes.art-partner.net</ttp:Name> " +
				"                                <ttp:Description>Trojan.StealRAT</ttp:Description> " +
				"                            </ttp:Malware_Instance> " +
				"                        </ttp:Malware> " +
				"                    </ttp:Behavior> " +
				"                    <ttp:Resources> " +
				"                        <ttp:Tools> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>notes.art-partner.net/sm32</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>notes.art-partner.net/sm64</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                        </ttp:Tools> " +
				"                    </ttp:Resources> " +
				"                    <ttp:Information_Source> " +
				"                        <stixCommon:Identity> " +
				"                            <stixCommon:Name>MalwareDomainList</stixCommon:Name> " +
				"                        </stixCommon:Identity> " +
				"                    </ttp:Information_Source> " +
				"                </stixCommon:TTP> " +
				"            </indicator:Indicated_TTP> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>DNSName</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Properties xsi:type=\"DNSRecordObj:DNSRecordObjectType\"> " +
				"                        <cyboxCommon:Custom_Properties> " +
				"                            <cyboxCommon:Property name=\"Registrant\">Registrar Abuse Contact abuse@enom.com</cyboxCommon:Property> " +
				"                        </cyboxCommon:Custom_Properties> " +
				"                        <DNSRecordObj:Description>notes.art-partner.net</DNSRecordObj:Description> " +
				"                        <DNSRecordObj:Domain_Name> " +
				"                            <URIObj:Value>notes.art-partner.net</URIObj:Value> " +
				"                        </DNSRecordObj:Domain_Name> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>DNSName</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Properties xsi:type=\"DNSRecordObj:DNSRecordObjectType\"> " +
				"                        <DNSRecordObj:Description>62-76-188-80.clodo.ru.</DNSRecordObj:Description> " +
				"                        <DNSRecordObj:Domain_Name> " +
				"                            <URIObj:Value>62-76-188-80.clodo.ru.</URIObj:Value> " +
				"                        </DNSRecordObj:Domain_Name> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>ip</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Description>62.76.188.80</cybox:Description> " +
				"                    <cybox:Properties category=\"ipv4-addr\" xsi:type=\"AddressObj:AddressObjectType\"> " +
				"                        <AddressObj:Address_Value>62.76.188.80</AddressObj:Address_Value> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>Address</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Description>62.76.188.80, port 80</cybox:Description> " +
				"                    <cybox:Properties category=\"ipv4-addr\" xsi:type=\"AddressObj:AddressObjectType\"> " +
				"                        <AddressObj:Address_Value>62.76.188.80:80</AddressObj:Address_Value> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"    </stix:Indicators> " +
				"</stix:STIX_Package> ";



			STIXPackage expectedPackage = new STIXPackage().fromXMLString(expectedVerts);
			
			assertTrue(mdlTsExt.validate(receivedPackage));
			
			assertEquals(expectedPackage.getIndicators(), receivedPackage.getIndicators());
		    
		} catch (IOException e) {
			e.printStackTrace();
			fail("IOException");
		} catch (Exception e) {
			e.printStackTrace();
			fail("Exception");
		}
	}

	
	/**
	 * Test with "www.toll-net.be" sample data
	 */
	@Test
	public void test_www_toll_net_be()
	{
		String entryName = "www.toll-net.be";
		boolean localMode = true;
		String content;
		
		try {
			Map<String,String> pageContent = loadContent(entryName, localMode);
			content = pageContent.get("content");
			
			MalwareDomainListToStixExtractor mdlTsExt = new MalwareDomainListToStixExtractor(content);
			STIXPackage receivedPackage = mdlTsExt.getStixPackage();
									
		//	System.out.println(receivedPackage.toXMLString(true));
		
			String expectedVerts = 
				"<?xml version=\"1.0\" encoding=\"UTF-8\"?> " +
				"<stix:STIX_Package " +
				"    id=\"stucco:MalwareDomainList-40db6a38-f9e5-474c-ae8c-6df7e70e3acb\" " +
				"    timestamp=\"2015-07-09T20:59:00.508Z\" " +
				"    xmlns=\"http://xml/metadataSharing.xsd\" " +
				"    xmlns:AddressObj=\"http://cybox.mitre.org/objects#AddressObject-2\" " +
				"    xmlns:DNSRecordObj=\"http://cybox.mitre.org/objects#DNSRecordObject-2\" " +
				"    xmlns:URIObj=\"http://cybox.mitre.org/objects#URIObject-2\" " +
				"    xmlns:cybox=\"http://cybox.mitre.org/cybox-2\" " +
				"    xmlns:cyboxCommon=\"http://cybox.mitre.org/common-2\" " +
				"    xmlns:indicator=\"http://stix.mitre.org/Indicator-2\" " +
				"    xmlns:stix=\"http://stix.mitre.org/stix-1\" " +
				"    xmlns:stixCommon=\"http://stix.mitre.org/common-1\" " +
				"    xmlns:stucco=\"stucco\" xmlns:ttp=\"http://stix.mitre.org/TTP-1\"> " +
				"    <stix:STIX_Header> " +
				"        <stix:Title>MalwareDomainList</stix:Title> " +
				"    </stix:STIX_Header> " +
				"    <stix:Indicators> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>Malware</indicator:Type> " +
				"            <indicator:Valid_Time_Position> " +
				"                <indicator:Start_Time>2014-08-19T00:34:00.000-04:00</indicator:Start_Time> " +
				"            </indicator:Valid_Time_Position> " +
				"            <indicator:Indicated_TTP> " +
				"                <stixCommon:TTP xsi:type=\"ttp:TTPType\"> " +
				"                    <ttp:Behavior> " +
				"                        <ttp:Malware> " +
				"                            <ttp:Malware_Instance> " +
				"                                <ttp:Name>MalwareDomainList_www.toll-net.be</ttp:Name> " +
				"                                <ttp:Description>Exploit, Exploit.DOS, PHP.Flood, PHP.RemoteUploader.Shell, PHP.Shell, PHP.Shell.Proxy, PHP.Shells, PHP.Shells, PHP.IRCBots, Part of Perl.IRCBot, Part of vulnerability scanner, Perl.IRCBot, Perl.RFIScanner, Python.Scanner</ttp:Description> " +
				"                            </ttp:Malware_Instance> " +
				"                        </ttp:Malware> " +
				"                    </ttp:Behavior> " +
				"                    <ttp:Resources> " +
				"                        <ttp:Tools> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/14814.c</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/auto.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/bad.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/badjce.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/file.tar.gz</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/files.tar.gz</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/food.php</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/index.inc.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/magic1.php</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/magic2.php</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/osco.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/ramk.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/root.c</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/scan8.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/slowpost.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/sod.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/spender.tgz</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/test.py</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/udp.php</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/vulns</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/west.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                            <ttp:Tool> " +
				"                                <cyboxCommon:Name>www.toll-net.be/images/stories/wp.txt</cyboxCommon:Name> " +
				"                                <stixCommon:Title>url</stixCommon:Title> " +
				"                            </ttp:Tool> " +
				"                        </ttp:Tools> " +
				"                    </ttp:Resources> " +
				"                    <ttp:Information_Source> " +
				"                        <stixCommon:Identity> " +
				"                            <stixCommon:Name>MalwareDomainList</stixCommon:Name> " +
				"                        </stixCommon:Identity> " +
				"                    </ttp:Information_Source> " +
				"                </stixCommon:TTP> " +
				"            </indicator:Indicated_TTP> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>DNSName</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Properties xsi:type=\"DNSRecordObj:DNSRecordObjectType\"> " +
				"                        <cyboxCommon:Custom_Properties> " +
				"                            <cyboxCommon:Property name=\"Registrant\">Not shown, please visit www.dns.be for webbased whois. / support@hostbasket.com</cyboxCommon:Property> " +
				"                        </cyboxCommon:Custom_Properties> " +
				"                        <DNSRecordObj:Description>www.toll-net.be</DNSRecordObj:Description> " +
				"                        <DNSRecordObj:Domain_Name> " +
				"                            <URIObj:Value>www.toll-net.be</URIObj:Value> " +
				"                        </DNSRecordObj:Domain_Name> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>DNSName</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Properties xsi:type=\"DNSRecordObj:DNSRecordObjectType\"> " +
				"                        <DNSRecordObj:Description>uu194-7-157-205.unknown.uunet.be.</DNSRecordObj:Description> " +
				"                        <DNSRecordObj:Domain_Name> " +
				"                            <URIObj:Value>uu194-7-157-205.unknown.uunet.be.</URIObj:Value> " +
				"                        </DNSRecordObj:Domain_Name> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>ip</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Description>194.7.157.205</cybox:Description> " +
				"                    <cybox:Properties category=\"ipv4-addr\" xsi:type=\"AddressObj:AddressObjectType\"> " +
				"                        <AddressObj:Address_Value>194.7.157.205</AddressObj:Address_Value> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"        <stix:Indicator " +
				"            xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"indicator:IndicatorType\"> " +
				"            <indicator:Type>Address</indicator:Type> " +
				"            <indicator:Observable> " +
				"                <cybox:Observable_Source> " +
				"                    <cyboxCommon:Information_Source_Type>MalwareDomainList</cyboxCommon:Information_Source_Type> " +
				"                </cybox:Observable_Source> " +
				"                <cybox:Object> " +
				"                    <cybox:Description>194.7.157.205, port 80</cybox:Description> " +
				"                    <cybox:Properties category=\"ipv4-addr\" xsi:type=\"AddressObj:AddressObjectType\"> " +
				"                        <AddressObj:Address_Value>194.7.157.205:80</AddressObj:Address_Value> " +
				"                    </cybox:Properties> " +
				"                </cybox:Object> " +
				"            </indicator:Observable> " +
				"        </stix:Indicator> " +
				"    </stix:Indicators> " +
				"</stix:STIX_Package> ";

		    String expectedEdges = "["+
		    		"  {"+
		    		"    '_type': 'edge',"+
		    		"    'outVType': 'malware',"+
		    		"    'source': 'MalwareDomainList',"+
		    		"    '_id': 'MalwareDomainList_www.toll-net.be_communicatesWith_194.7.157.205:80',"+
		    		"    'description': 'MalwareDomainList_www.toll-net.be communicates with 194.7.157.205, port 80',"+
		    		"    '_outV': 'MalwareDomainList_www.toll-net.be',"+
		    		"    '_label': 'communicatesWith',"+
		    		"    'inVType': 'address',"+
		    		"    '_inV': '194.7.157.205:80'"+
		    		"  },"+
		    		"  {"+
		    		"    '_type': 'edge',"+
		    		"    'outVType': 'address',"+
		    		"    'source': 'MalwareDomainList',"+
		    		"    '_id': '194.7.157.205:80_hasIP_194.7.157.205',"+
		    		"    'description': '194.7.157.205, port 80 has IP 194.7.157.205',"+
		    		"    '_outV': '194.7.157.205:80',"+
		    		"    '_label': 'hasIP',"+
		    		"    'inVType': 'ip',"+
		    		"    '_inV': '194.7.157.205'"+
		    		"  },"+
		    		"  {"+
		    		"    '_type': 'edge',"+
		    		"    'reverse': false,"+
		    		"    'outVType': 'address',"+
		    		"    'source': 'MalwareDomainList',"+
		    		"    '_id': '194.7.157.205:80_hasDNSName_www.toll-net.be',"+
		    		"    'description': '194.7.157.205, port 80 has DNS name www.toll-net.be',"+
		    		"    '_outV': '194.7.157.205:80',"+
		    		"    '_label': 'hasDNSName',"+
		    		"    'inVType': 'DNSName',"+
		    		"    '_inV': 'www.toll-net.be'"+
		    		"  },"+
		    		"  {"+
		    		"    '_type': 'edge',"+
		    		"    'reverse': true,"+
		    		"    'outVType': 'address',"+
		    		"    'source': 'MalwareDomainList',"+
		    		"    '_id': '194.7.157.205:80_hasDNSName_uu194-7-157-205.unknown.uunet.be.',"+
		    		"    'description': '194.7.157.205, port 80 has DNS name uu194-7-157-205.unknown.uunet.be.',"+
		    		"    '_outV': '194.7.157.205:80',"+
		    		"    '_label': 'hasDNSName',"+
		    		"    'inVType': 'DNSName',"+
		    		"    '_inV': 'uu194-7-157-205.unknown.uunet.be.'"+
		    		"  }"+
			    	  "]";
		
			STIXPackage expectedPackage = new STIXPackage().fromXMLString(expectedVerts);
			
			assertTrue(mdlTsExt.validate(receivedPackage));
			
			assertEquals(expectedPackage.getIndicators(), receivedPackage.getIndicators());
    
		} catch (IOException e) {
			e.printStackTrace();
			fail("IOException");
		} catch (Exception e) {
			e.printStackTrace();
			fail("Exception");
		}
	}

	/**
	 * Test with the newest 10k records available.
	 */
	@Test
	public void test_newest_10k()
	{
		
		try {
			URL u = new URL("http://www.malwaredomainlist.com/mdl.php?inactive=&sort=Date&search=&colsearch=All&ascordesc=DESC&quantity=10000&page=0");
			String content = IOUtils.toString(u);
			
			MalwareDomainListToStixExtractor mdlTsExt = new MalwareDomainListToStixExtractor(content);
			STIXPackage receivedPackage = mdlTsExt.getStixPackage();
									
		//	System.out.println(receivedPackage.toXMLString(true));
							
			assertTrue(mdlTsExt.validate(receivedPackage));
			//This test just grabs everything and combines it all, so the result won't be predictable (or useful)
			//However, since this is so much more data than usual, it's a very effective way to find errors in the extractor.
		    
		} catch (IOException e) {
			e.printStackTrace();
			fail("IOException");
		} catch (Exception e) {
			e.printStackTrace();
			fail("Exception");
		}
	}
}
